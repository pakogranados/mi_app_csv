{% extends "sidebar.html" %}
{% block content %}
<div class="container-fluid mt-4">
  <h2 class="mb-4">Inventario de Productos Terminados</h2>

  <table id="tabla-inventario" class="table table-bordered table-striped">
    <thead>
      <tr>
        <th style="width:60px; text-align:center;">ID</th>
        <th style="width:150px; text-align:center;">Producto</th>
        <th style="width:100px; text-align:center;">Inventario Inicial</th>
        <th style="width:100px; text-align:center;">Entradas</th>
        <th style="width:100px; text-align:center;">Salidas</th>
        <th style="width:60px; text-align:center;">Disponible</th>
        <th style="width:60px; text-align:center;">Valor Inventario</th>
        <th style="width:60px; text-align:center;">Aprobado</th>
        <th style="width:120px; text-align:center;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for i in inventario %}
      <tr>
        <td class="text-center">{{ i.id }}</td>
        <td>{{ i.producto }}</td>
        <td class="text-end">{{ i.inventario_inicial }}</td>

        <!-- Entradas -->
        <td class="text-end">
          {% if i.mercancia_id %}
          <a class="btn btn-sm btn-outline-info"
             href="{{ url_for('inventario_movimientos', mercancia_id=i.mercancia_id, almacen=1) }}">
            {{ i.entradas }}
          </a>
          {% else %}
          <span class="text-muted">{{ i.entradas }}</span>
          {% endif %}
        </td>

        <!-- Salidas -->
        <td class="text-end">
          {% if i.mercancia_id %}
          <a class="btn btn-sm btn-outline-secondary"
             href="{{ url_for('inventario_movimientos', mercancia_id=i.mercancia_id, almacen=1) }}">
            {{ i.salidas }}
          </a>
          {% else %}
          <span class="text-muted">{{ i.salidas }}</span>
          {% endif %}
        </td>

        <td class="text-end">{{ i.disponible }}</td>
        <td class="text-end">${{ '%.2f'|format(i.valor_inventario or 0) }}</td>
        <td class="text-center">{{ 'Sí' if i.aprobado else 'No' }}</td>

        <td class="text-center">
          {% if i.mercancia_id %}
          <a href="{{ url_for('inventario_movimientos', mercancia_id=i.mercancia_id, almacen=1) }}"
             class="btn btn-sm btn-info">Movimientos</a>
          {% else %}
          <button class="btn btn-sm btn-info" disabled title="No vinculado a catálogo">
            Movimientos
          </button>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="{{ url_for('nueva_compra') }}" class="btn btn-primary">Registrar otra compra</a>
</div>
{% endblock %}
