{% extends "sidebar.html" %}
{% block content %}
<div class="container-fluid mt-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h4 class="mb-0">Inventario – Producción en Proceso (WIP)</h4>
    <a class="btn btn-primary" href="{{ url_for('crear_produccion') }}">Iniciar Producción</a>
  </div>

  <div class="card">
    <div class="card-body p-2">
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Producto</th>
              <th class="text-end">Inicial</th>
              <th class="text-end">Entradas</th>
              <th class="text-end">Salidas</th>
              <th class="text-end">Disponible</th>
              <th class="text-end">Valor</th>
              <th class="text-center">Aprobado</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for i in inventario %}
            <tr>
              <td>{{ i.id }}</td>
              <td>{{ i.producto }}</td>
              <td class="text-end">{{ i.inventario_inicial }}</td>
              <td class="text-end">
                {% if i.mercancia_id %}
                  <a class="btn btn-sm btn-outline-info"
                     href="{{ url_for('inventario_movimientos_wip', producto_base_id=i.producto_base_id, almacen=2) }}">
                    {{ '%.2f'|format(i.entradas) }}
                  </a>
                {% else %}
                  <span class="text-muted">{{ '%.2f'|format(i.entradas) }}</span>
                {% endif %}
              </td>
              <td class="text-end">
                {% if i.mercancia_id %}
                  <a class="btn btn-sm btn-outline-secondary"
                     href="{{ url_for('inventario_movimientos_wip', producto_base_id=i.producto_base_id, almacen=2) }}">
                    {{ '%.2f'|format(i.salidas) }}
                  </a>
                {% else %}
                  <span class="text-muted">{{ '%.2f'|format(i.salidas) }}</span>
                {% endif %}
              </td>
              <td class="text-end">{{ '%.2f'|format(i.disponible) }}</td>
              <td class="text-end">${{ '%.2f'|format(i.valor_inventario or 0) }}</td>
              <td class="text-center">{{ 'Sí' if i.aprobado else 'No' }}</td>
              <td class="text-center">
                {% if i.mercancia_id %}
                  <a class="btn btn-sm btn-info"
                    href="{{ url_for('inventario_movimientos_wip', producto_base_id=i.producto_base_id, almacen=2) }}">
                      Movimientos
                  </a>
                {% else %}
                  <button class="btn btn-sm btn-info" disabled>Movimientos</button>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="9" class="text-center text-muted">Sin datos</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}