{% extends "sidebar.html" %}

{% block title %}Probar WhatsApp - ERP{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-1 fw-bold">
                <i class="fab fa-whatsapp text-success"></i> Probar WhatsApp
            </h1>
            <p class="text-muted mb-0">Enviar mensaje de prueba</p>
        </div>
        <a href="{{ url_for('configurar_whatsapp_b2b') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <!-- Estado -->
            <div class="alert {% if whatsapp_enabled %}alert-success{% else %}alert-danger{% endif %} mb-4">
                {% if whatsapp_enabled %}
                <i class="fas fa-check-circle"></i> <strong>Twilio configurado correctamente</strong>
                {% else %}
                <i class="fas fa-times-circle"></i> <strong>Twilio no configurado</strong>
                <p class="mb-0 small">Configura TWILIO_ACCOUNT_SID y TWILIO_AUTH_TOKEN en las variables de entorno.</p>
                {% endif %}
            </div>

            <!-- Resultado -->
            {% if resultado %}
            <div class="alert {% if resultado.exito %}alert-success{% else %}alert-danger{% endif %} mb-4">
                <i class="fas {% if resultado.exito %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
                {{ resultado.mensaje }}
            </div>
            {% endif %}

            <!-- Formulario -->
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-paper-plane"></i> Enviar Mensaje de Prueba</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label class="form-label">N칰mero de Tel칠fono *</label>
                            <div class="input-group">
                                <span class="input-group-text">游쓇릖 +52</span>
                                <input type="tel" name="telefono" class="form-control form-control-lg" 
                                       placeholder="6141234567" required
                                       pattern="[0-9]{10}"
                                       maxlength="10">
                            </div>
                            <small class="text-muted">Ingresa los 10 d칤gitos sin espacios</small>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Mensaje</label>
                            <textarea name="mensaje" class="form-control" rows="4" 
                                      placeholder="Escribe tu mensaje de prueba...">游댒 *Prueba de Notificaci칩n*

Este es un mensaje de prueba del sistema ERP B2B.

Si recibes este mensaje, las notificaciones por WhatsApp est치n funcionando correctamente.</textarea>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-success btn-lg" {% if not whatsapp_enabled %}disabled{% endif %}>
                                <i class="fab fa-whatsapp"></i> Enviar WhatsApp
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Instrucciones Sandbox -->
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> Usando Twilio Sandbox</h6>
                </div>
                <div class="card-body">
                    <p class="small">Si est치s usando el Sandbox de Twilio para pruebas:</p>
                    <ol class="small">
                        <li>El destinatario debe enviar primero <code>join &lt;c칩digo&gt;</code> al n칰mero de Twilio</li>
                        <li>Esto activa la sesi칩n de 24 horas</li>
                        <li>Una vez activado, podr치s enviar mensajes</li>
                    </ol>
                    <a href="https://www.twilio.com/console/sms/whatsapp/sandbox" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-external-link-alt"></i> Ir a Twilio Sandbox
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}